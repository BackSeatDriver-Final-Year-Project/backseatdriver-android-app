<!DOCTYPE html>
<html>

<head>
    <title>OBD2 Reader - Update Signal</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimal-ui">
    <script src="cordova.js"></script>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }

        table {
            width: 60%;
            margin: 20px auto;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 8px;
            text-align: left;
        }

        h4 {
            margin-top: 20px;
        }

        #number-input {
            font-size: 20px;
            padding: 10px;
            margin-top: 20px;
        }

        .result-container {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <h1>Back Seat Driver</h1>
    <h4>Account: <b id="user_id"></b></h4>

    <!-- Number Input to Update API -->
    <h3>Update Vehicle Signal</h3>
    <input type="number" id="number-input" value="0" min="0" max="100" step="1">
    <div class="result-container">
        <p>Current Value: <span id="current-value">0</span></p>
    </div>

    <script>
document.addEventListener("deviceready", function () {
    const socket = io('https://backseatdriver-ie-api.onrender.com'); // Backend URL

    socket.on('connect', function () {
        console.log('‚úÖ Connected to Socket.IO server:', socket.id);
    });

    socket.on('connect_error', function (err) {
        console.error('‚ùå Socket connection error:', err);
    });

    // Emit vehicle signal change to the backend via Socket.IO
    function updateVehicleSignal(value) {
        const VID = localStorage.getItem('VID'); // Get vehicle ID from localStorage

        if (!VID) {
            console.warn('‚ö† No Vehicle ID found in localStorage');
            return;
        }

        if (socket.connected) {
            socket.emit('sendMessage', { VID, value });
            console.log('üì° Signal update sent:', { VID, value });
        } else {
            console.warn('‚ö† Socket is not connected. Cannot send signal.');
        }
    }

    // Event listener for number input to track changes
    const numberInput = document.getElementById('number-input');
    numberInput.addEventListener('input', function () {
        const currentValue = numberInput.value;
        document.getElementById('current-value').innerText = currentValue; // Update UI with new value
        updateVehicleSignal(currentValue); // Send value to backend via socket
    });

    // Listen for live updates from the backend
    socket.on('receiveMessage', function (data) {
        console.log('üì• Received vehicle live data:', data);
        document.getElementById('number-input').innerText = JSON.stringify(data); // Display on UI
    });

    socket.on('disconnect', function () {
        console.log('Disconnected from server');
    });

}, false);
    </script>
</body>

</html>
